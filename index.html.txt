<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø±Ø­Ù„Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ ğŸ‰</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* ğŸ¨ Ø£Ù„ÙˆØ§Ù† Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³Ù‡ÙˆÙ„Ø© */
      --mint: #9ee7f5;          /* Mint Blue Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
      --mint-strong:#6bd6ea;    /* Ø¯Ø±Ø¬Ø© Ø£Ù‚ÙˆÙ‰ Ù„Ù„Ù‡ÙˆÙØ± */
      --bg:#0f1b22;             /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø£Ù†ÙŠÙ‚Ø© */
      --card:#13242c;           /* Ø¨Ø·Ø§Ù‚Ø§Øª */
      --text:#eaf7fb;           /* Ù†Øµ ÙØ§ØªØ­ */
      --muted:#a9c8d2;          /* Ù†Øµ Ø®Ø§ÙØª */
      --accent1:#ffd166;        /* Ù„Ù…Ø³Ø§Øª Ù„ÙŠÙ…ÙˆÙ†ÙŠ */
      --accent2:#ff9ac2;        /* ÙˆØ±Ø¯ÙŠ Ø¨Ø§Ø³ØªÙŠÙ„ */
      --ok:#22c55e; --bad:#ef4444;
      --radius:22px; --radius-sm:14px;
      --shadow:0 22px 80px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial; background: radial-gradient(1000px 600px at 90% -10%, #15313a 0%, transparent 60%), radial-gradient(1200px 800px at -10% 110%, #17363f 0%, transparent 60%), var(--bg); color:var(--text)}
    a{color:inherit}
    .container{min-height:100svh;display:grid;place-items:center;padding:24px}
    .card{width:min(980px,100%);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.10);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
    h1{margin:0;font-size:clamp(26px,4.5vw,44px);letter-spacing:.5px}
    .subtitle{color:var(--muted);margin-top:6px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .badge{border:1px dashed rgba(255,255,255,.25);padding:6px 10px;border-radius:999px;color:var(--muted)}
    .section{margin-top:16px}
    .pane{background:var(--card);border:1px solid rgba(255,255,255,.10);border-radius:var(--radius);padding:20px}
    label{display:block;margin-bottom:8px;color:var(--muted);font-weight:600}
    input[type="text"], input[type="number"], textarea{width:100%;border:none;outline:none;background:#0c1b21;color:var(--text);border:1px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);padding:14px}
    textarea{min-height:120px;resize:vertical}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{cursor:pointer;border:none;border-radius:var(--radius-sm);padding:12px 16px;font-weight:800}
    .primary{background:var(--mint);color:#06232b}
    .primary:hover{background:var(--mint-strong)}
    .ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.25)}
    .ghost:hover{border-color:rgba(255,255,255,.45)}
    .center{text-align:center}

    /* âœ… Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø­Ù„Ø© */
    .section-view{display:none}
    .section-view.active{display:block}

    /* ğŸš§ Ø±Ø³Ø§Ø¦Ù„ ØµØºÙŠØ±Ø© */
    .msg{padding:10px 12px;border-radius:12px;font-size:14px;margin-top:10px}
    .msg.bad{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.35)}
    .msg.ok{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.35)}

    /* ğŸŠ ÙƒÙˆÙ†ÙÙŠØªÙŠ + Ø¨Ø§Ù„ÙˆÙ†Ø§Øª */
    #confetti{position:fixed;inset:0;pointer-events:none}
    .balloon{position:fixed;bottom:-120px;width:34px;height:42px;border-radius:50% 50% 48% 52%;background:var(--mint);opacity:.93;animation:floatUp 9s linear forwards}
    .balloon::after{content:"";position:absolute;bottom:-16px;left:50%;width:2px;height:18px;background:#fff;opacity:.7;transform:translateX(-50%)}
    @keyframes floatUp{to{transform:translateY(-120vh) translateX(20px);opacity:.2}}

    /* ğŸ“– ÙƒØªØ§Ø¨ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (CSS 3D) */
    .book-wrap{display:grid;place-items:center}
    .book{position:relative;width:min(820px,96vw);height:460px;perspective:1600px;}
    .page{position:absolute;inset:0;background:#10242b;border:1px solid rgba(255,255,255,.12);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.35);transform-origin:left;transition:transform .8s cubic-bezier(.2,.8,.2,1)}
    .page .inner{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:18px}
    .page h3{margin:0 0 8px 0}
    .book-controls{display:flex;justify-content:space-between;margin-top:12px}
    .book-controls button{min-width:120px}
    .page.is-flipped{transform:rotateY(-180deg)}
    .spine{position:absolute;left:50%;top:12px;transform:translateX(-50%);width:8px;height:calc(100% - 24px);background:linear-gradient(90deg, #0f1f25, #0a171b);border-radius:8px}

    /* ğŸƒ ÙƒØ±ÙˆØª Ø§Ù„ØµÙˆØ± */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px}
    .cardX{position:relative;aspect-ratio:3/4;perspective:1000px}
    .cardX .face{position:absolute;inset:0;border-radius:16px;border:1px solid rgba(255,255,255,.12);backface-visibility:hidden;display:grid;place-items:center;padding:10px;text-align:center}
    .cardX .front{background:#0c1b21}
    .cardX .back{background:#112a31;transform:rotateY(180deg)}
    .cardX.flip .front{transform:rotateY(180deg)}
    .cardX.flip .back{transform:rotateY(360deg)}
    .cardX img{width:100%;height:100%;object-fit:cover;border-radius:14px}

    /* ğŸ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸ */
    .loot-wrap{display:grid;place-items:center;gap:14px}
    .chest{width:220px;height:160px;border-radius:14px;background:linear-gradient(#855325,#5b3415);position:relative;box-shadow:inset 0 8px 0 rgba(0,0,0,.2),0 18px 60px rgba(0,0,0,.35);cursor:pointer}
    .chest::before{content:"";position:absolute;inset:0;border-radius:14px;border:3px solid #d6a350;}
    .lid{position:absolute;left:0;top:0;width:100%;height:60px;background:linear-gradient(#a56b30,#70451e);border-bottom:4px solid #d6a350;border-top-left-radius:14px;border-top-right-radius:14px;transform-origin:top;transition:transform .5s}
    .lock{position:absolute;left:50%;top:62px;transform:translateX(-50%);width:36px;height:46px;background:#d6a350;border-radius:8px 8px 12px 12px;box-shadow:inset 0 -4px 0 rgba(0,0,0,.2)}
    .loot-item{min-height:42px;padding:10px 14px;border:1px dashed rgba(255,255,255,.25);border-radius:12px;background:#0f1f25}
    .chest.open .lid{transform:rotateX(-72deg)}

    /* ğŸ” Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
    .gate-input{display:grid;gap:10px;max-width:520px;margin-inline:auto}
    .note{font-size:13px;color:var(--muted)}

    /* ğŸ” Ù…ÙˆØ¯Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø­ÙÙˆØ¸Ø© (inbox) */
    dialog{border:none;border-radius:20px;max-width:min(820px,96vw);padding:0;box-shadow:0 20px 120px rgba(0,0,0,.5);} 
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .modal{background:#0f1f25;color:#fff;border-radius:20px;overflow:hidden}
    .modal header{padding:16px 20px;background:#0b171c;border-bottom:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;align-items:center}
    .modal .content{padding:18px 20px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid rgba(255,255,255,.08);padding:10px;text-align:start}

  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="container">
    <div class="card">
      <header>
        <div>
          <h1>Ø±Ø­Ù„Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ <span id="displayName" style="color:var(--mint)">Ø£Ø¯Ù‡Ù…</span> ğŸ‚</h1>
          <div class="subtitle">ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù„ÙŠÙ‡Ø§ Ø·Ø§Ø¨Ø¹Ù‡Ø§ â€” Ø§Ù„Ø£Ù„ÙˆØ§Ù† Mint BlueØŒ ÙˆÙƒÙ„ Ø­Ø§Ø¬Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ğŸ‘‡</div>
        </div>
        <div class="row">
          <span class="badge">Ù…Ù„Ù ÙˆØ§Ø­Ø¯</span>
          <span class="badge">Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª</span>
          <span class="badge">Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹</span>
        </div>
      </header>

      <!-- âœ… Section: Gate 1 -->
      <section id="gate1" class="section section-view active">
        <div class="pane center">
          <h2>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 â€” Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
          <p class="subtitle">Ù„Ø§Ø²Ù… ØªØ¬Ø§ÙˆØ¨ ØµØ­ Ø¹Ø´Ø§Ù† ØªÙƒÙ…Ù„</p>
          <div class="gate-input">
            <label for="q1">Ø§Ù„Ø³Ø¤Ø§Ù„: <strong>4??</strong></label>
            <input id="q1" type="text" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§" aria-label="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„">
            <div class="btns">
              <button class="primary" id="btnQ1">ØªØ£ÙƒÙŠØ¯</button>
            </div>
            <div id="q1Msg" class="msg bad" style="display:none">ØºÙ„Ø·â€¦ Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ ğŸ‘€</div>
          </div>
        </div>
      </section>

      <!-- âœ… Section: Gate 2 -->
      <section id="gate2" class="section section-view">
        <div class="pane center">
          <h2>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 â€” ÙƒÙ„Ù…Ø© Ø³Ø±</h2>
          <p class="subtitle">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ</p>
          <div class="gate-input">
            <label for="q2">Ø§Ù„Ø³Ø¤Ø§Ù„: <strong>Ø¥ÙŠÙ‡ Ø§Ø³Ù… LØŸ (Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ)</strong></label>
            <input id="q2" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¤ÙŠ" aria-label="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ">
            <div class="btns">
              <button class="primary" id="btnQ2">ØªØ£ÙƒÙŠØ¯</button>
            </div>
            <div id="q2Msg" class="msg bad" style="display:none">Ù„Ø³Ù‡ Ù…Ø´ Ù…Ø¸Ø¨ÙˆØ·â€¦</div>
          </div>
        </div>
      </section>

      <!-- âœ… Section: Gate 3 -->
      <section id="gate3" class="section section-view">
        <div class="pane center">
          <h2>Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 â€” Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</h2>
          <p class="subtitle">Ø¢Ø®Ø± Ø®Ø·ÙˆØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª ğŸ‰</p>
          <div class="gate-input">
            <label for="q3">Ø§Ù„Ø³Ø¤Ø§Ù„: <strong>11??</strong></label>
            <input id="q3" type="text" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§" aria-label="Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø«">
            <div class="btns">
              <button class="primary" id="btnQ3">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø­ØªÙØ§Ù„</button>
            </div>
            <div id="q3Msg" class="msg bad" style="display:none">Ø¥Ø¬Ø§Ø¨Ø© ØºÙ„Ø·â€¦</div>
          </div>
        </div>
      </section>

      <!-- ğŸ‰ Celebration (auto after Gate 3) + intro to book -->
      <section id="celebrate" class="section section-view">
        <div class="pane center">
          <h2>ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª! ğŸ¥³</h2>
          <p class="subtitle">Ø®Ø¨Ø·ØªÙŠÙ† ØªÙ†Ø·ÙŠØ·â€¦ ÙˆØ¨Ø§Ù„ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù…Ø§! Ø¨Ø¹Ø¯ Ø«ÙˆØ§Ù†ÙŠ Ù‡ØªØ¯Ø®Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„ÙƒÙŠÙˆØª.</p>
          <div class="btns center" style="justify-content:center">
            <button class="ghost" id="skipToBook">Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø¢Ù†</button>
          </div>
        </div>
      </section>

      <!-- ğŸ“– Book Section -->
      <section id="book" class="section section-view">
        <div class="pane">
          <h2 class="center">Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„ÙƒÙŠÙˆØª ğŸ“–</h2>
          <div class="book-wrap">
            <div class="book" id="bookElem">
              <div class="spine"></div>
              <!-- Ø§Ù„ØµÙØ­Ø§Øª ØªØªÙˆÙ„Ø¯ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù…Ù† CONFIG.book.pages -->
            </div>
            <div class="book-controls">
              <button class="ghost" id="prevPage">âŸµ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
              <button class="primary" id="nextPage">Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© âŸ¶</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸƒ Cards Section -->
      <section id="cards" class="section section-view">
        <div class="pane">
          <div class="row" style="justify-content:space-between">
            <h2>ÙƒØ±ÙˆØª Ø§Ù„ØµÙˆØ±</h2>
            <div class="row">
              <label class="badge" for="upload">Ø±ÙØ¹ÙŠ ØµÙˆØ±Ùƒ Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="upload" type="file" accept="image/*" multiple />
            </div>
          </div>
          <p class="subtitle">Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒØ§Ø±Øª Ø¹Ø´Ø§Ù† ÙŠØªÙ‚Ù„Ø¨ ÙˆÙŠØ¸Ù‡Ø± Ø¶Ù‡Ø±Ù‡ Ø§Ù„Ù…ÙƒØªÙˆØ¨ ÙÙŠÙ‡ ÙƒÙ„Ø§Ù…Ùƒ ğŸ’Œ</p>
          <div id="cardsWrap" class="cards" aria-live="polite"></div>
        </div>
      </section>

      <!-- ğŸ Loot Box Section -->
      <section id="loot" class="section section-view">
        <div class="pane loot-wrap">
          <h2>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸ ğŸ</h2>
          <p class="subtitle">Ø§Ø¶ØºØ·ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚â€¦ ÙƒÙ„ Ù…Ø±Ø© Ø­Ø§Ø¬Ø© Ù…Ø®ØªÙ„ÙØ©!</p>
          <div class="chest" id="chest">
            <div class="lid"></div>
            <div class="lock"></div>
          </div>
          <div id="lootItem" class="loot-item center">â€” Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙØ§Ø¬Ø¢Øª â€”</div>
          <div class="btns"><button id="again" class="primary">ÙƒÙ…Ø§Ù† Ù…Ø±Ø©</button></div>
        </div>
      </section>

      <footer class="section center" style="color:var(--muted);font-size:14px">
        <div class="row" style="justify-content:center;gap:10px">
          <span class="badge">Ù„ÙˆÙ† Ø£Ø³Ø§Ø³ÙŠ: Mint Blue</span>
          <span class="badge">Ø§Ø¶ØºØ·ÙŠ F8 Ù„Ø¹Ø±Ø¶ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
        </div>
      </footer>

    </div>
  </div>

  <!-- ğŸ” Inbox Modal -->
  <dialog id="inbox">
    <div class="modal">
      <header>
        <strong>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ù…Ø­Ù„ÙŠÙ‹Ø§)</strong>
        <button id="closeInbox" class="ghost" style="padding:6px 10px">Ø¥ØºÙ„Ø§Ù‚</button>
      </header>
      <div class="content">
        <table class="table" id="inboxTable">
          <thead>
            <tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="btns" style="margin-top:16px">
          <button id="exportCsv" class="primary">ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ CSV</button>
          <button id="clearInbox" class="ghost">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ (Ù…Ø­Ù„ÙŠ)</button>
        </div>
        <p class="note" style="margin-top:8px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø­ÙØ¸ Ù‡Ù†Ø§ Ù…Ø­Ù„ÙŠ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ø¤Ù‚ØªÙ‹Ø§. Ù‡Ù†Ø¨Ø¯Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ù€ Google Sheets Ø¹Ø´Ø§Ù† ØªÙˆØµÙ„Ùƒ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†.</p>
      </div>
    </div>
  </dialog>

  <script>
    // ===============================
    // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³Ù‡ÙˆÙ„Ø©
    // ===============================
    const CONFIG = {
      name: 'Ø£Ø¯Ù‡Ù…',
      gates: {
        q1: { question:'4??', answer:'29' },
        q2: { question:'Ø¥ÙŠÙ‡ Ø§Ø³Ù… LØŸ (Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ)', answer:'Ù„Ø¤ÙŠ', normalize: true },
        q3: { question:'11??', answer:'2' }
      },
      book: {
        // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª â€” Ø¹Ø¯ÙŠÙ„ÙŠ Ø¨Ø±Ø§Ø­ØªÙƒ
        pages: [
          {
            title:'Ù…Ø±Ø­Ø¨Ù‹Ø§',
            left: { html: '<h3>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ ğŸ‘‹</h3><p>Ø¯ÙŠ Ø£ÙˆÙ„ ØµÙØ­Ø© ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„ÙƒÙŠÙˆØª. ØªÙ‚Ø¯Ù‘Ø± ØªÙ‚Ù„Ù‘Ø¨ Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ´ÙˆÙ Ø§Ù„Ø¨Ø§Ù‚ÙŠ âœ¨</p>' },
            right:{ html: '<img alt="balloons" src="https://images.unsplash.com/photo-1541280890142-c72565bf5f3f?q=80&w=800&auto=format&fit=crop" style="width:100%;height:100%;object-fit:cover;border-radius:12px">' }
          },
          {
            title:'Ø­ÙƒØ§ÙŠØ© ØµØºÙŠØ±Ø©',
            left: { html: '<p>Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø±ÙŠ ØªÙƒØªØ¨ÙŠ ÙÙ‚Ø±Ø© Ù„Ø·ÙŠÙØ©ØŒ Ø£Ùˆ ØªØ¶ÙŠÙÙŠ ØµÙˆØ±Ø© Ø£Ùˆ GIF â€” Ø£ÙŠ Ø­Ø§Ø¬Ø© ØªØ­Ø¨ÙŠÙ‡Ø§.</p>' },
            right:{ html: '<p>Ø§Ù„Ù†ØµÙˆØµ ÙƒÙ„Ù‡Ø§ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† CONFIG.book.pages</p>' }
          },
          {
            title:'Ø±Ø³Ø§Ù„Ø© Ø­Ø±Ø©',
            left: { html: '<p>Ù„Ùˆ Ø­Ø§Ø¨Ø© ØªØ¶ÙŠÙÙŠ Ø±ÙˆØ§Ø¨Ø· Ø£Ùˆ Ø³Ø·ÙˆØ± ÙƒØªÙŠØ±â€¦ ÙƒÙ„Ù‡ Ù‡Ù†Ø§.</p>' },
            right:{ type:'messageBox' } // â† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ Ø¨ÙˆÙƒØ³ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
          },
        ]
      },
      cards: {
        // Ø¶Ù‡Ø± Ø§Ù„ÙƒØ±ÙˆØª â€” Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ù‚ØµÙŠØ±Ø© Ù„ÙƒÙ„ ÙƒØ§Ø±Øª Ø¨Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨
        backs: [
          'Ø£ÙˆÙ„ Ø­Ø§Ø¬Ø© Ø­Ø¨ÙŠØª Ø£Ù‚ÙˆÙ„Ù‡Ø§ Ù„Ùƒâ€¦',
          'ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨ ğŸ’™',
          'Ù…ÙØ§Ø¬Ø£Ø© ØµØºÙŠØ±Ø© Ù„ÙŠÙƒ!',
          'Ø°ÙƒØ±ÙŠØ§Øª Ø­Ù„ÙˆØ© Ø¨ØªÙƒØ¨Ø± Ø¨ÙŠÙ†Ø§',
          'Ø¶Ø­ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© Ø¹Ù„ÙŠÙ‘ ğŸ˜„'
        ],
        // Ù„Ùˆ Ù…Ø§ ØªØ±ÙØ¹ØªØ´ ØµÙˆØ±ØŒ Ù‡Ù†Ø³ØªØ®Ø¯Ù… ØµÙˆØ± Ù…ÙƒØ§Ù†ÙŠØ© Ù‡Ù†Ø§ (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
        placeholders: [
          'https://images.unsplash.com/photo-1542156822-6924d1a71ace?q=80&w=800&auto=format&fit=crop',
          'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?q=80&w=800&auto=format&fit=crop',
          'https://images.unsplash.com/photo-1606046604972-77cc76aee944?q=80&w=800&auto=format&fit=crop',
          'https://images.unsplash.com/photo-1512428559087-560fa5ceab42?q=80&w=800&auto=format&fit=crop',
          'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=800&auto=format&fit=crop'
        ]
      },
      loot: {
        items: [
          'ğŸŸï¸ ØªØ°ÙƒØ±Ø© Ø¹Ø´Ø§ Ø¹Ù„Ù‰ Ø°ÙˆÙ‚ÙŠ',
          'ğŸ§ Ø¨Ù„Ø§ÙŠ Ù„ÙŠØ³Øª Ø®Ø§ØµØ© Ù„Ùƒ',
          'ğŸ“¸ ØµÙˆØ±Ø© Ù†Ø¹Ù…Ù„Ù‡Ø§ Ø¯Ù„ÙˆÙ‚ØªÙŠ',
          'ğŸ° Ù‚Ø·Ø¹Ø© ÙƒÙŠÙƒ Ø¥Ø¶Ø§ÙÙŠØ©',
          'ğŸ® Ø¬ÙˆÙ„Ø© Ù„Ø¹Ø¨Ø© Ø£Ù†Ø§ ÙˆØ£Ù†Øª',
          'ğŸ§© Ù„ØºØ² ØµØºÙŠØ± ÙˆØ¬Ø§ÙŠØ²ØªÙ‡ Ù…ÙØ§Ø¬Ø£Ø©',
          'ğŸ’Œ Ø±Ø³Ø§Ù„Ø© Ù…Ø·Ø¨ÙˆØ¹Ø© Ù‡ÙˆØµÙ„Ù‡Ø§Ù„Ùƒ'
        ]
      }
    };
    document.getElementById('displayName').textContent = CONFIG.name;

    // ===============================
    // ğŸ” Gates Logic
    // ===============================
    const S = (id)=>document.getElementById(id);
    const show = (id)=>{ document.querySelectorAll('.section-view').forEach(s=>s.classList.remove('active')); S(id).classList.add('active'); scrollTo({top:0,behavior:'smooth'}); };

    S('btnQ1').onclick = ()=>{
      const ok = (S('q1').value||'').trim() === CONFIG.gates.q1.answer;
      S('q1Msg').style.display = ok? 'none':'block';
      if(ok) show('gate2');
    };

    function normalizeArabic(str){
      return str.replace(/[\u064B-\u065F]/g,'') // Ø­Ø±ÙƒØ§Øª
                .replace(/[Ø¥Ø£Ø¢Ø§]/g,'Ø§')
                .replace(/Ù‰/g,'ÙŠ').replace(/Ø¤/g,'Ùˆ').replace(/Ø¦/g,'ÙŠ')
                .replace(/Ø©/g,'Ù‡').trim();
    }

    S('btnQ2').onclick = ()=>{
      let v = (S('q2').value||'').trim();
      const ans = CONFIG.gates.q2.answer;
      const ok = CONFIG.gates.q2.normalize
        ? normalizeArabic(v) === normalizeArabic(ans)
        : v === ans;
      S('q2Msg').style.display = ok? 'none':'block';
      if(ok) show('gate3');
    };

    S('btnQ3').onclick = ()=>{
      const ok = (S('q3').value||'').trim() === CONFIG.gates.q3.answer;
      S('q3Msg').style.display = ok? 'none':'block';
      if(ok){
        show('celebrate');
        party();
        setTimeout(()=>show('book'), 1800);
      }
    };

    S('skipToBook').onclick = ()=> show('book');

    // ===============================
    // ğŸŠ Celebration (Confetti + Balloons)
    // ===============================
    const confetti = document.getElementById('confetti');
    const ctx = confetti.getContext('2d');
    function resize(){ confetti.width = innerWidth; confetti.height = innerHeight }
    addEventListener('resize', resize); resize();
    const pieces=[];
    function Confetti(){ this.x=Math.random()*confetti.width; this.y=-10; this.size=6+Math.random()*8; this.speed=1+Math.random()*3; this.tilt=Math.random()*10; this.spin=Math.random()*.1 }
    function confettiBurst(n=160){ for(let i=0;i<n;i++) pieces.push(new Confetti()); }
    function draw(){ ctx.clearRect(0,0,confetti.width,confetti.height); for(let i=pieces.length-1;i>=0;i--){ const p=pieces[i]; p.y+=p.speed; p.tilt+=p.spin; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.tilt); ctx.fillStyle=`hsl(${(p.y/3)%360},90%,65%)`; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); if(p.y>confetti.height+20) pieces.splice(i,1);} requestAnimationFrame(draw); } draw();
    function spawnBalloons(n=8){ for(let i=0;i<n;i++){ const b=document.createElement('div'); b.className='balloon'; b.style.left=Math.random()*100+'vw'; b.style.animationDuration=(7+Math.random()*6)+'s'; b.style.background=`hsl(${Math.random()*360},80%,60%)`; document.body.appendChild(b); setTimeout(()=>b.remove(),12000); }}
    function party(){ confettiBurst(260); spawnBalloons(12); }

    // ===============================
    // ğŸ“– Book Builder
    // ===============================
    const bookEl = S('bookElem');
    let currentPage = 0; // index Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ù…Ø´ ØµÙØ­Ø© ÙˆØ±Ù‚)

    function buildBook(){
      bookEl.innerHTML = '<div class="spine"></div>';
      CONFIG.book.pages.forEach((p, i)=>{
        const page = document.createElement('div');
        page.className = 'page';
        page.style.zIndex = (100 - i);
        const inner = document.createElement('div');
        inner.className = 'inner';
        // left
        const L = document.createElement('div');
        if(p.left?.html){ L.innerHTML = p.left.html; }
        // right
        const R = document.createElement('div');
        if(p.right?.html){ R.innerHTML = p.right.html; }
        if(p.right?.type === 'messageBox'){
          R.innerHTML = `
            <label style="display:block;margin-bottom:8px">âœ¨ Ø§ÙƒØªØ¨ Ø£ÙŠ Ø­Ø§Ø¬Ø© ÙˆÙ‡ØªÙˆØµÙ„ÙŠâ€¦ Ø£Ùˆ Ù…Ù…ÙƒÙ† ØªØ³ÙŠØ¨Ù‡Ø§ Ø¹Ø§Ø¯ÙŠ ğŸ˜Šâ¤ï¸</label>
            <textarea id="freeMsg" placeholder="Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø­Ø±Ø© Ù„Ù„ÙƒØªØ§Ø¨Ø©"></textarea>
            <div class="btns"><button id="sendMsg" class="primary">Ø¥Ø±Ø³Ø§Ù„</button></div>
            <div id="sendStatus" class="note"></div>
          `;
        }
        inner.append(L,R);
        page.appendChild(inner);
        bookEl.appendChild(page);
      });
      updateBookView();
    }

    function updateBookView(){
      const pages = [...bookEl.querySelectorAll('.page')];
      pages.forEach((pg, idx)=>{
        pg.style.transform = idx <= currentPage ? 'rotateY(-180deg)' : 'rotateY(0)';
      });
    }

    S('prevPage').onclick = ()=>{ if(currentPage>0){ currentPage--; updateBookView(); } else { show('cards'); }};
    S('nextPage').onclick = ()=>{ if(currentPage < CONFIG.book.pages.length-1){ currentPage++; updateBookView(); } else { show('cards'); }};

    buildBook();

    // ===============================
    // ğŸ’Œ Messages storage (Ù…Ø­Ù„ÙŠ Ù…Ø¤Ù‚ØªÙ‹Ø§)
    // ===============================
    const LS_KEY = 'birthday_messages_v1';
    function getMsgs(){ try{ return JSON.parse(localStorage.getItem(LS_KEY))||[] }catch{ return [] } }
    function setMsgs(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id==='sendMsg'){
        const ta = S('freeMsg');
        const text = (ta?.value||'').trim();
        if(!text){ S('sendStatus').textContent = 'ØªÙ… â€” Ù…ÙÙŠØ´ Ø±Ø³Ø§Ù„Ø©ØŒ Ù†ÙƒÙ…Ù„ Ø¹Ø§Ø¯ÙŠ.'; S('sendStatus').style.color = 'var(--muted)'; showToast('Ù…ÙÙŠØ´ Ø±Ø³Ø§Ù„Ø© â€” ØªÙ…Ø§Ù…'); return; }
        const arr = getMsgs();
        arr.push({when:new Date().toLocaleString('ar-EG'), text});
        setMsgs(arr);
        ta.value='';
        S('sendStatus').textContent = 'Ø§ØªØ³Ø¬Ù„Øª Ø¨Ù†Ø¬Ø§Ø­ ğŸ’¾';
        S('sendStatus').style.color = 'var(--mint)';
        showToast('Ø§ØªØ³Ø¬Ù„Øª Ø±Ø³Ø§Ù„ØªÙƒ');
      }
    });

    // ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¨ÙˆÙƒØ³ Ø¨Ù…ÙØªØ§Ø­ F8
    addEventListener('keydown', (e)=>{ if(e.key==='F8'){ openInbox(); }});

    function openInbox(){
      const tbody = S('inboxTable').querySelector('tbody');
      tbody.innerHTML='';
      getMsgs().forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${r.when}</td><td>${escapeHtml(r.text)}</td>`;
        tbody.appendChild(tr);
      });
      S('inbox').showModal();
    }
    S('closeInbox').onclick = ()=> S('inbox').close();

    S('exportCsv').onclick = ()=>{
      const rows = [["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ø±Ø³Ø§Ù„Ø©"], ...getMsgs().map(r=>[r.when, r.text.replace(/\n/g,' ')])];
      const csv = rows.map(r=>r.map(cell=>`"${cell.replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob(["\uFEFF"+csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'messages.csv'; a.click();
    };

    S('clearInbox').onclick = ()=>{ if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŸ')){ localStorage.removeItem(LS_KEY); openInbox(); }}

    // ===============================
    // ğŸƒ Cards Builder
    // ===============================
    const cardsWrap = S('cardsWrap');

    function buildCards(images){
      cardsWrap.innerHTML='';
      const imgs = images?.length ? images : CONFIG.cards.placeholders;
      const backs = CONFIG.cards.backs;
      imgs.forEach((src,i)=>{
        const div = document.createElement('div');
        div.className = 'cardX';
        div.innerHTML = `
          <div class="face front">${ src.startsWith('data:') || src.startsWith('http') ? `<img src="${src}" alt="card-${i}">` : `<div>${escapeHtml(src)}</div>` }</div>
          <div class="face back"><div>${escapeHtml(backs[i%backs.length]||'â€”')}</div></div>
        `;
        div.addEventListener('click', ()=> div.classList.toggle('flip'));
        cardsWrap.appendChild(div);
      });
    }

    // Ø±ÙØ¹ ØµÙˆØ± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
    S('upload').addEventListener('change', (e)=>{
      const files = [...e.target.files];
      if(!files.length){ buildCards(); return; }
      const readers = files.map(f=> new Promise(res=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.readAsDataURL(f); }));
      Promise.all(readers).then(dataUrls=> buildCards(dataUrls));
    });

    buildCards();

    // ===============================
    // ğŸ Loot Box
    // ===============================
    const chest = S('chest');
    const lootItem = S('lootItem');
    function openChest(){
      chest.classList.add('open');
      const item = CONFIG.loot.items[Math.floor(Math.random()*CONFIG.loot.items.length)];
      lootItem.textContent = item;
      party();
      setTimeout(()=> chest.classList.remove('open'), 900);
    }
    chest.addEventListener('click', openChest);
    S('again').addEventListener('click', openChest);

    // ===============================
    // ğŸ§© Utilities
    // ===============================
    function escapeHtml(str=''){ return str.replace(/[&<>"]+/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[s]||s)); }
    function showToast(txt){
      const t = document.createElement('div');
      t.textContent = txt;
      t.style.position='fixed'; t.style.insetInline='0'; t.style.bottom='24px'; t.style.margin='0 auto';
      t.style.background='rgba(0,0,0,.6)'; t.style.color='white'; t.style.padding='10px 16px'; t.style.borderRadius='12px'; t.style.width='fit-content'; t.style.boxShadow='0 10px 30px rgba(0,0,0,.4)';
      document.body.appendChild(t); setTimeout(()=>t.remove(), 1600);
    }

    // ===============================
    // ğŸ”— ØªÙ†Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
    // Ø¨Ø¹Ø¯ Ø§Ù„ÙƒØ±ÙˆØª â†’ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸
    const observer = new MutationObserver(()=>{
      if(S('cards').classList.contains('active')){
        // Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨ ÙŠÙ†ØªÙ‚Ù„ Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸ 
        setTimeout(()=>{ if(S('cards').classList.contains('active')) show('loot'); }, 30000);
      }
    });
    observer.observe(document.body, {attributes:true, subtree:true, attributeFilter:['class']});

    // ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¨ÙˆÙƒØ³ Ù„Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠÙ‡ #inbox
    if(location.hash === '#inbox'){ openInbox(); }
  </script>
</body>
</html>